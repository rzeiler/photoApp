function ScaleImage(e){$("p.info").text("Scale Image");var t=document.createElement("canvas"),a=e.naturalHeight,i=e.naturalWidth,n=a>max_height?max_height/a:1,o=i>max_width?max_width/i:1,l=o>n?o:n;t.width=i*l,t.height=a*l;var r=t.getContext("2d");r.imageSmoothingEnabled=!0,r.drawImage(e,0,0,i,a,0,0,i*l,a*l),ListCanvas.push(t);var d=ListCanvas.length/files.length*100;if($("div.determinate").css("width",d+"%"),$("p.info").text(files.length==ListCanvas.length?"Bild bearbeitung fertig.":"Bild wird bearbeitet..."),100==d){len=ListCanvas.length;for(var s=0;s<len;s++){var p=ListCanvas[s],c=files[s];alert(c.size);var f=p.toDataURL(c.type,.3);$.ajax({method:"POST",url:"upload.php",contentType:"application/x-www-form-urlencoded",data:{name:c.name,type:c.type,base64:f,folder:folder,ext:c.name.split(".").pop().toLowerCase()}}).done(function(e){var t=locSco.pictures;t.push(e.pictures),locSco.pictures=t,locSco.$apply(),Materialize.toast("Success!",4e3),len==s&&(inpFile.value="",ListCanvas=[],files=null,setTimeout(function(){$("#modal1").modal("close")},1e3))})}}}function readAndPreview(e){if(/\.(jpe?g|png|gif)$/i.test(e.name)){var t=new FileReader;t.addEventListener("load",function(){var t=new Image;t.height=100,t.title=e.name,t.src=this.result,preview.appendChild(t),ScaleImage(t)},!1),t.readAsDataURL(e)}}var max_width=3e3,max_height=2e3,ListCanvas=[],preview,files,folder,inpFile,locSco,folder_data;myApp.controller("photoController",["$scope","$sce","$http","$routeParams","$location","$timeout",function(e,t,a,i,n,o){locSco=e,folder=i.id,$("nav .tabs").append("<li class='tab'><a class='grey-text'>Bilder</a></li>"),$("nav.white").addClass("z-depth-0"),$("div.navbar-fixed nav").show(),$("div#nav").addClass("navbar-fixed"),links=[{url:"#/album",class:"",title:"Back",icon:"chevron_left"}],e.index.links=links,btns=[{target:"modalAlbum",title:"Edit",icon:"mode_edit"}],e.index.btns=btns,e.parentobj={},e.parentobj.folder={},e.parentobj.folder.id=i.id,e.templateUrl="views/album_form.html",a.post("tph.php",{action:"get_pictures",id:e.parentobj.folder.id}).then(function(t){t.data.folder&&(folder_data=t.data,e.pictures=t.data.pictures,e.parentobj.users=t.data.users,e.parentobj.name=t.data.folder.name,e.index.title=t.data.folder.title,e.parentobj.folder.title=t.data.folder.title,e.parentobj.folder.detail=t.data.folder.detail)}),e.open=function(t){n.path("/show/"+e.parentobj.folder.id+"/"+t)},e.edit=function(e){n.path("/photo/"+i.id+"/edit/"+e)},e.delete=function(e,t){confirm("Delete, You are sure?")&&a.post("tph.php",{action:"remove_picture",id:e,path:t}).then(function(e){var t=e.data;t.removed_picture&&1==t.removed_picture&&document.getElementById(t.id).remove(),t.error?Materialize.toast(t.error,6e3):Materialize.toast("Deleted!",4e3),"signin"==t.message&&n.path("/signin")},function(e){console.log(e)})},inpFile=document.querySelector("input#file"),preview=document.querySelector("#preview"),e.add=function(){$(inpFile).trigger("click")},inpFile.addEventListener("change",function(e){setTimeout(function(){$("#modal1").modal("open"),files=inpFile.files;for(var e=0;e<files.length;e++)readAndPreview(files[e])},100)})}]);